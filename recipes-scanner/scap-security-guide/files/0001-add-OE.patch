From 16360f38cde07f74ce88ddc18bb67e9631f42d75 Mon Sep 17 00:00:00 2001
From: Armin Kuster <akuster@mvista.com>
Date: Sun, 4 Jun 2017 15:12:58 -0700
Subject: [PATCH 1/2] add OE

Signed-off-by: Armin Kuster <akuster@mvista.com>
---
 CMakeLists.txt                                    |  8 ++++++-
 shared/modules/map_product_module.py              |  5 +++-
 shared/oval/installed_OS_is_oenodistro.xml        | 28 +++++++++++++++++++++++
 shared/oval/installed_OS_is_part_of_OE_family.xml | 28 +++++++++++++++++++++++
 4 files changed, 67 insertions(+), 2 deletions(-)
 create mode 100644 shared/oval/installed_OS_is_oenodistro.xml
 create mode 100644 shared/oval/installed_OS_is_part_of_OE_family.xml

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 71bb1c1..19849b1 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -41,6 +41,7 @@ option(SSG_PRODUCT_UBUNTU1404 "If enabled, the Ubuntu/14.04 SCAP content will be
 option(SSG_PRODUCT_UBUNTU1604 "If enabled, the Ubuntu/16.04 SCAP content will be built" TRUE)
 option(SSG_PRODUCT_WRLINUX "If enabled, the WRLinux SCAP content will be built" TRUE)
 option(SSG_PRODUCT_WEBMIN "If enabled, the Webmin SCAP content will be built" TRUE)
+option(SSG_PRODUCT_OPENEMBEDDED "If enabled, the OpenEmbedded SCAP content will be built" TRUE)
 
 option(SSG_CENTOS_DERIVATIVES_ENABLED "If enabled, CentOS derivative content will be built from the RHEL content" TRUE)
 option(SSG_SCIENTIFIC_LINUX_DERIVATIVES_ENABLED "If enabled, Scientific Linux derivative content will be built from the RHEL content" TRUE)
@@ -93,7 +94,7 @@ if (NOT XMLWF_EXECUTABLE)
     message(FATAL_ERROR "xmlwf is required!")
 endif()
 
-find_program(SED_EXECUTABLE NAMES sed)
+find_program(SED_EXECUTABLE NAMES /home/akuster/oss/maint/openembedded-core/build/tmp-glibc/hosttools/sed)
 if (NOT SED_EXECUTABLE)
     message(FATAL_ERROR "sed is required!")
 endif()
@@ -137,6 +138,7 @@ message("Ubuntu 14.04: ${SSG_PRODUCT_UBUNTU1404}")
 message("Ubuntu 16.04: ${SSG_PRODUCT_UBUNTU1604}")
 message("WRLinux: ${SSG_PRODUCT_WRLINUX}")
 message("Webmin: ${SSG_PRODUCT_WEBMIN}")
+message("OpenEmbedded: ${SSG_PRODUCT_OPENEMBEDDED}")
 
 message(" ")
 
@@ -214,6 +216,10 @@ if (SSG_PRODUCT_WEBMIN)
     add_subdirectory("Webmin")
 endif()
 
+if (SSG_PRODUCT_OPENEMBDEDDED)
+    add_subdirectory("OpenEmbedded")
+endif()
+
 install(FILES "${CMAKE_SOURCE_DIR}/LICENSE"
     DESTINATION ${CMAKE_INSTALL_DOCDIR})
 install(FILES "${CMAKE_SOURCE_DIR}/README.md"
diff --git a/shared/modules/map_product_module.py b/shared/modules/map_product_module.py
index 6a866a9..e4cd696 100644
--- a/shared/modules/map_product_module.py
+++ b/shared/modules/map_product_module.py
@@ -15,8 +15,9 @@ FUSE = 'JBoss Fuse'
 OPENSUSE = 'OpenSUSE'
 SUSE = 'SUSE Linux Enterprise'
 WRLINUX = 'Wind River Linux'
+OPENEMBEDDED = "OpenEmbedded"
 
-multi_product_list = ['rhel', 'fedora', 'rhel-osp', 'debian', 'ubuntu', 'wrlinux', 'opensuse', 'sle']
+multi_product_list = ['rhel', 'fedora', 'rhel-osp', 'debian', 'ubuntu', 'wrlinux', 'opensuse', 'sle', 'openembedded']
 
 
 def parse_product_name(product):
@@ -66,6 +67,8 @@ def map_product(version):
         product_name = SUSE
     if re.findall('wrlinux', version):
         product_name = WRLINUX
+    if re.findall('openembedded', version):
+        product_name = OPENEMBEDDED 
 
     if product_name is None:
         raise RuntimeError("Can't map version '%s' to any known product!"
diff --git a/shared/oval/installed_OS_is_oenodistro.xml b/shared/oval/installed_OS_is_oenodistro.xml
new file mode 100644
index 0000000..7ff15b4
--- /dev/null
+++ b/shared/oval/installed_OS_is_oenodistro.xml
@@ -0,0 +1,28 @@
+<def-group>
+  <definition class="inventory"
+  id="installed_OS_is_OEnodistro" version="2">
+    <metadata>
+      <title>Debian 8</title>
+      <affected family="openembedded">
+        <platform>nodistro</platform>
+      </affected>
+      <reference ref_id="cpe:/o:openembedded:nodistro:0"
+      source="CPE" />
+      <description>The operating system installed on the system is
+      OpenEmbedded</description>
+    </metadata>
+    <criteria operator="AND">
+      <extend_definition comment="Installed OS is part of the OE family"
+      definition_ref="installed_OS_is_part_of_OE_family.xml" />
+      <criterion comment="OpenEmbedded is installed"
+      test_ref="test_oenodistro" />
+    </criteria>
+  </definition>
+
+  <ind:textfilecontent54_object id="test_oenodistro" version="1" comment="Check OpenEmbedded version">
+    <ind:filepath>/etc/os_version</ind:filepath>
+    <ind:pattern operation="pattern match">^8.[0-9]+$</ind:pattern>
+    <ind:instance datatype="int">1</ind:instance>
+  </ind:textfilecontent54_object>
+
+</def-group>
diff --git a/shared/oval/installed_OS_is_part_of_OE_family.xml b/shared/oval/installed_OS_is_part_of_OE_family.xml
new file mode 100644
index 0000000..2ac5472
--- /dev/null
+++ b/shared/oval/installed_OS_is_part_of_OE_family.xml
@@ -0,0 +1,28 @@
+<def-group>
+  <definition class="inventory" id="installed_OS_is_part_of_OE_family" version="1">
+    <metadata>
+      <title>Installed operating system is part of the OpenEmbedded family</title>
+      <affected family="openembedded">
+        <platform>multi_platform_all</platform>
+      </affected>
+      <description>The operating system installed on the system is part of the OpenEmebedded OS family</description>
+    </metadata>
+    <criteria>
+      <criterion comment="Installed operating system is part of the openembedded family"
+      test_ref="test_openembedded_family" />
+    </criteria>
+  </definition>
+
+  <ind:family_test id="test_openembedded_family" check="all" check_existence="at_least_one_exists"
+  comment="Test installed OS is part of the openembedded family" version="1">
+    <ind:object object_ref="object_openembedded_family" />
+    <ind:state state_ref="state_openembedded_family" />
+  </ind:family_test>
+
+  <ind:family_object id="object_openembedded_family" version="1" />
+
+  <ind:family_state id="state_openembedded_family" version="1">
+    <ind:family>openembedded</ind:family>
+  </ind:family_state>
+
+</def-group>
-- 
2.7.4

